<odoo>
  <data>

    <!-- Form view do wizard -->
    <record id="crm_sales_unit.view_redistribute_lead_wizard" model="ir.ui.view">
      <field name="name">redistribute.lead.wizard.form</field>
      <field name="model">redistribute.lead.wizard</field>
      <field name="arch" type="xml">
        <form string="Redistribuição de Leads">
          <group>
            <!-- Campo de corretor origem (ativo ou inativo, respeitando allowed_user_ids) -->
            <field name="source_user_id" context="{'active_test': False}"/>
            <!-- Corretores destino -->
            <field name="target_user_ids" widget="many2many_tags"/>
          </group>
          <footer>
            <button string="Redistribuir"
                    type="object"
                    name="action_redistribute"
                    class="btn-primary"
                    confirm="Você tem certeza que deseja distribuir os leads do Corretor selecionado para os Corretores destino? Essa ação é IRREVERSÍVEL!"/>
            <button string="Cancelar" class="btn-secondary" special="cancel"/>
          </footer>
        </form>
      </field>
    </record>

    <!-- Action do wizard -->
    <record id="crm_sales_unit.action_redistribute_lead_wizard" model="ir.actions.act_window">
      <field name="name">Redistribuição de Leads</field>
      <field name="res_model">redistribute.lead.wizard</field>
      <field name="view_mode">form</field>
      <field name="target">new</field>
      <field name="view_id" ref="crm_sales_unit.view_redistribute_lead_wizard"/>
      <field name="context">{'active_test': False}</field>
    </record>

    <!-- Menu -->
    <menuitem id="crm_sales_unit.menu_funnel_redistribute"
              name="Redistribuição de Leads"
              parent="crm_sales_unit.menu_funnel_root"
              action="crm_sales_unit.action_redistribute_lead_wizard"
              sequence="30"
              groups="crm_sales_unit.group_manager,crm_sales_unit.group_director,crm_sales_unit.group_president"/>
  </data>
</odoo>
