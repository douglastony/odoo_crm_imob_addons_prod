<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <data noupdate="0">

    <!-- Regra padrão: usuários veem histórico apenas dos usuários permitidos pela hierarquia -->
    <record id="rule_history_visibility_by_hierarchy" model="ir.rule">
      <field name="name">Histórico de Etapas: Visibilidade pela hierarquia</field>
      <field name="model_id" ref="crm_sales_unit.model_crm_lead_stage_history"/>
      <field name="domain_force">[('user_id', 'in', user.allowed_user_ids.ids)]</field>
      <field name="groups" eval="[(4, ref('base.group_user'))]"/>
      <field name="active" eval="True"/>
    </record>

    <!-- Regra extra para presidente: pode ver tudo (opcional, se quiser bypass) -->
    <record id="rule_history_visibility_president" model="ir.rule">
      <field name="name">Histórico de Etapas: Visibilidade total (Presidente)</field>
      <field name="model_id" ref="crm_sales_unit.model_crm_lead_stage_history"/>
      <field name="domain_force">[(1,'=',1)]</field>
      <field name="groups" eval="[(4, ref('crm_sales_unit.group_president'))]"/>
      <field name="active" eval="True"/>
    </record>

  </data>
</odoo>
